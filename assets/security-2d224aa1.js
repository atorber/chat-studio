import{r as f,m as C,c as k,e as x,w as t,f as d,g as e,A as _,a as l,by as N,X as y,a0 as S,W as E,a1 as U,bz as A,b as M,k as q,v as I,t as $,bA as R,bB as D,_ as F,aA as L,i as T,F as G,K as H,L as z}from"./index-da544b70.js";import{S as B,i as K,a as O,b as W}from"./common-1aca7980.js";import{h as X}from"./strings-8042df5b.js";const j={style:{width:"100%","text-align":"right"}},J={__name:"EditorPassword",props:["modelValue"],emits:["update:modelValue","close"],setup(g,{emit:b}){const h=b,c=f(),s=C({oldPassword:"",newPassword:"",newPassword2:""}),V={oldPassword:{required:!0,trigger:["blur","input"],message:"登录密码不能为空！"},newPassword:{required:!0,trigger:["blur","input"],message:"新密码不能为空！"},newPassword2:{required:!0,trigger:["blur","change"],validator(m,o){if(o){if(s.newPassword!=s.newPassword2)return new Error("两次密码填写不一致！")}else return new Error("确认密码不能为空！");return!0}}},r=f(!1),w=()=>{r.value=!0;let m=A({old_password:s.oldPassword,new_password:s.newPassword});m.then(o=>{o.code==200?(window.$message.success("密码修改成功"),h("update:modelValue",!1)):window.$message.warning(o.message)}),m.finally(()=>{r.value=!1})},i=m=>{m.preventDefault(),c.value.validate(o=>{!o&&w()})};return(m,o)=>(k(),x(l(U),{show:g.modelValue,preset:"card",title:"修改密码？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":v=>{m.$emit("update:modelValue",v)}},{footer:t(()=>[d("div",j,[e(l(N),{type:"tertiary",onClick:o[3]||(o[3]=v=>m.$emit("update:modelValue",!1))},{default:t(()=>[_(" 取消 ")]),_:1}),e(l(N),{type:"primary",class:"mt-l15",loading:r.value,onClick:i},{default:t(()=>[_(" 保存修改 ")]),_:1},8,["loading"])])]),default:t(()=>[e(l(E),{ref_key:"formRef",ref:c,model:s,rules:V},{default:t(()=>[e(l(y),{label:"登录密码",path:"oldPassword"},{default:t(()=>[e(l(S),{placeholder:"请填写登录密码",type:"password",value:s.oldPassword,"onUpdate:value":o[0]||(o[0]=v=>s.oldPassword=v)},null,8,["value"])]),_:1}),e(l(y),{label:"设置新密码",path:"newPassword"},{default:t(()=>[e(l(S),{placeholder:"请填写新密码",type:"password",value:s.newPassword,"onUpdate:value":o[1]||(o[1]=v=>s.newPassword=v)},null,8,["value"])]),_:1}),e(l(y),{label:"确认新密码",path:"newPassword2"},{default:t(()=>[e(l(S),{placeholder:"请再次填写新密码",type:"password",value:s.newPassword2,"onUpdate:value":o[2]||(o[2]=v=>s.newPassword2=v)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"]))}},Q={style:{width:"100%","text-align":"right"}},Y={__name:"EditorMobile",props:["modelValue"],emits:["update:modelValue","success"],setup(g,{emit:b}){const h=b,c=f(),s=C({password:"",mobile:"",sms_code:""}),V={password:{required:!0,trigger:["input"],message:"账号密码不能为空！"},mobile:{required:!0,trigger:["input"],message:"手机号不能为空！"},sms_code:{required:!0,trigger:["change"],message:"验证码不能为空！"}},r=f(!1),w=f(0),i=new B("CHANGE_MOBILE_SMS",120,n=>w.value=n),m=()=>{if(!K(s.mobile)){window.$message.warning("请正确填写手机号");return}O({mobile:s.mobile,channel:"change_account"}).then(({code:a,data:p,message:u})=>{a==200?(i.start(),p.is_debug?(s.sms_code=p.sms_code,window.$message.success("已开启验证码自动填充")):window.$message.success("短信发送成功")):window.$message.warning(u)})},o=()=>{r.value=!0;let n=R(s);n.then(({code:a,message:p})=>{a==200?(window.$message.success("手机号修改成功..."),h("success",s.mobile)):window.$message.warning(p)}),n.finally(()=>{r.value=!1})},v=n=>{n.preventDefault(),c.value.validate(a=>{!a&&o()})};return(n,a)=>{const p=M("n-button");return k(),x(l(U),{show:g.modelValue,preset:"card",title:"换绑手机？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":u=>{n.$emit("update:modelValue",u)}},{footer:t(()=>[d("div",Q,[e(p,{type:"tertiary",onClick:a[3]||(a[3]=u=>n.$emit("update:modelValue",!1))},{default:t(()=>[_(" 取消 ")]),_:1}),e(p,{type:"primary",class:"mt-l15",loading:r.value,onClick:v},{default:t(()=>[_(" 保存修改 ")]),_:1},8,["loading"])])]),default:t(()=>[e(l(E),{ref_key:"formRef",ref:c,model:s,rules:V},{default:t(()=>[e(l(y),{label:"登录密码",path:"password"},{default:t(()=>[e(l(S),{placeholder:"请填写登录密码",type:"password",value:s.password,"onUpdate:value":a[0]||(a[0]=u=>s.password=u)},null,8,["value"])]),_:1}),e(l(y),{label:"新手机号码",path:"mobile"},{default:t(()=>[e(l(S),{placeholder:"请填写新手机号码",type:"text",value:s.mobile,"onUpdate:value":a[1]||(a[1]=u=>s.mobile=u)},null,8,["value"])]),_:1}),e(l(y),{label:"短信验证码",path:"sms_code"},{default:t(()=>[e(l(S),{placeholder:"请填写验证码",type:"text",value:s.sms_code,"onUpdate:value":a[2]||(a[2]=u=>s.sms_code=u)},null,8,["value"]),e(p,{tertiary:"",class:"mt-l5",onClick:m,disabled:w.value>0},{default:t(()=>[_(" 获取验证码 "),q(d("span",null,"("+$(w.value)+"s)",513),[[I,w.value>0]])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"])}}},Z={style:{width:"100%","text-align":"right"}},ee={__name:"EditorEmail",props:["modelValue"],emits:["update:modelValue","success"],setup(g,{emit:b}){const h=b,c=f(0),s=new B("CHANGE_EMAIL_SMS",120,n=>c.value=n),V=f(),r=C({password:"",email:"",code:""}),w={password:{required:!0,trigger:["input"],message:"账号密码不能为空！"},email:{required:!0,trigger:["input"],message:"邮箱不能为空！"},code:{required:!0,trigger:["change"],message:"验证码不能为空！"}},i=f(!1),m=()=>{W({email:r.email}).then(({code:a,message:p})=>{a==200?(s.start(),window.$message.success("邮件发送成功")):window.$message.warning(p)})},o=()=>{i.value=!0;let n=D(r);n.then(({code:a,message:p})=>{a==200?(window.$message.success("密码修改成功..."),h("success",r.email)):window.$message.warning(p)}),n.finally(()=>{i.value=!1})},v=n=>{n.preventDefault(),V.value.validate(a=>{!a&&o()})};return(n,a)=>{const p=M("n-button");return k(),x(l(U),{show:g.modelValue,preset:"card",title:"修改邮箱？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":u=>{n.$emit("update:modelValue",u)}},{footer:t(()=>[d("div",Z,[e(p,{type:"tertiary",onClick:a[3]||(a[3]=u=>n.$emit("update:modelValue",!1))},{default:t(()=>[_(" 取消 ")]),_:1}),e(p,{type:"primary",class:"mt-l15",loading:i.value,onClick:v},{default:t(()=>[_(" 保存修改 ")]),_:1},8,["loading"])])]),default:t(()=>[e(l(E),{ref_key:"formRef",ref:V,model:r,rules:w},{default:t(()=>[e(l(y),{label:"登录密码",path:"password"},{default:t(()=>[e(l(S),{placeholder:"请填写登录密码",type:"password",value:r.password,"onUpdate:value":a[0]||(a[0]=u=>r.password=u)},null,8,["value"])]),_:1}),e(l(y),{label:"新邮箱",path:"email"},{default:t(()=>[e(l(S),{placeholder:"请填写新邮箱",type:"text",value:r.email,"onUpdate:value":a[1]||(a[1]=u=>r.email=u)},null,8,["value"])]),_:1}),e(l(y),{label:"邮箱验证码",path:"code"},{default:t(()=>[e(l(S),{placeholder:"请填写验证码",type:"text",value:r.code,"onUpdate:value":a[2]||(a[2]=u=>r.code=u)},null,8,["value"]),e(p,{tertiary:"",class:"mt-l5",onClick:m,disabled:c.value>0},{default:t(()=>[_(" 获取验证码 "),q(d("span",null,"("+$(c.value)+"s)",513),[[I,c.value>0]])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"])}}};const P=g=>(H("data-v-0bbbdc8a"),g=g(),z(),g),se=P(()=>d("h3",{class:"title"},"安全设置",-1)),ae={class:"view-box"},le={class:"view-list"},te=P(()=>d("div",{class:"content"},[d("div",{class:"name"},"账户密码"),d("div",{class:"desc"},"当前密码强度 ：中")],-1)),oe={class:"tools"},de={class:"view-list"},ne={class:"content"},re=P(()=>d("div",{class:"name"},"绑定手机",-1)),ie={class:"desc"},ue={class:"tools"},me={class:"view-list"},pe={class:"content"},ce=P(()=>d("div",{class:"name"},"绑定邮箱",-1)),we={class:"desc"},ve={class:"tools"},fe={__name:"security",setup(g){const b=L(),h=f(!1),c=f(!1),s=f(!1),V=w=>{c.value=!1,b.mobile=w},r=w=>{s.value=!1,b.email=w};return(w,i)=>{const m=M("n-button");return k(),T(G,null,[d("section",null,[se,d("div",ae,[d("div",le,[te,d("div",oe,[e(m,{type:"primary",text:"",onClick:i[0]||(i[0]=o=>h.value=!0)},{default:t(()=>[_(" 修改 ")]),_:1})])]),d("div",de,[d("div",ne,[re,d("div",ie,"已绑定手机 ："+$(l(X)(l(b).mobile)),1)]),d("div",ue,[e(m,{type:"primary",text:"",onClick:i[1]||(i[1]=o=>c.value=!0)},{default:t(()=>[_(" 修改 ")]),_:1})])]),d("div",me,[d("div",pe,[ce,d("div",we,"已绑定邮箱 ："+$(l(b).email||"未设置"),1)]),d("div",ve,[e(m,{type:"primary",text:"",onClick:i[2]||(i[2]=o=>s.value=!0)},{default:t(()=>[_(" 修改 ")]),_:1})])])])]),e(J,{modelValue:h.value,"onUpdate:modelValue":i[3]||(i[3]=o=>h.value=o)},null,8,["modelValue"]),e(Y,{modelValue:c.value,"onUpdate:modelValue":i[4]||(i[4]=o=>c.value=o),onSuccess:V},null,8,["modelValue"]),e(ee,{modelValue:s.value,"onUpdate:modelValue":i[5]||(i[5]=o=>s.value=o),onSuccess:r},null,8,["modelValue"])],64)}}},he=F(fe,[["__scopeId","data-v-0bbbdc8a"]]);export{he as default};
