import{_ as N}from"./no-data-bde0995b.js";import{I as B,g as r,b5 as x,_ as E,b6 as W,aA as D,aq as Z,s as A,r as i,p as F,b as v,c,i as u,f as d,t as w,w as g,F as P,y as U,a as f,l as q,e as K,bm as O,bn as R,K as G,L as J}from"./index-0666afcb.js";import{M as Q}from"./MemberCard-eca4a3c2.js";import{S as X}from"./Search-e0585678.js";const Y=B("all-application",!1,function(e){return r("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[r("path",{d:"M18 6H8C6.89543 6 6 6.89543 6 8V18C6 19.1046 6.89543 20 8 20H18C19.1046 20 20 19.1046 20 18V8C20 6.89543 19.1046 6 18 6Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),r("path",{d:"M18 28H8C6.89543 28 6 28.8954 6 30V40C6 41.1046 6.89543 42 8 42H18C19.1046 42 20 41.1046 20 40V30C20 28.8954 19.1046 28 18 28Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),r("path",{d:"M40 6H30C28.8954 6 28 6.89543 28 8V18C28 19.1046 28.8954 20 30 20H40C41.1046 20 42 19.1046 42 18V8C42 6.89543 41.1046 6 40 6Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),r("path",{d:"M40 28H30C28.8954 28 28 28.8954 28 30V40C28 41.1046 28.8954 42 30 42H40C41.1046 42 42 41.1046 42 40V30C42 28.8954 41.1046 28 40 28Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null)])}),ee=()=>x("/api/v1/organize/department/all"),te=()=>x("/api/v1/organize/personnel/all");const oe=e=>(G("data-v-4e2ff6f8"),e=e(),J(),e),ne={class:"el-container is-vertical height100"},se={class:"el-header me-view-header bdr-b"},ae={style:{"font-weight":"500"}},re={class:"el-container"},le={key:0,class:"el-main me-scrollbar pd-10"},ie={class:"cards"},ce={key:1,class:"el-main flex-center"},de=oe(()=>d("img",{src:N,alt:""},null,-1)),ue={key:2,class:"el-aside aside bdr-l"},_e={__name:"organize",setup(e){const S=W(),j=D(),V=Z(),z=A("$user"),p=i(-1),h=i(""),m=i(!0),C=i([]),k=F(()=>C.value.filter(o=>o.nickname.match(h.value)!=null&&(p.value==-1||o.dept_items.some(s=>s.dept_id==p.value)))),b=i([]),y=i("全体成员"),L=o=>{j.uid!=o.user_id?V.toTalk(1,o.user_id,S):window.$message.info("禁止给自己发送消息!!!")};function T(o){const s={};o.forEach(a=>s[a.dept_id]=a);const t=a=>{let n=[];return a.split(",").forEach(_=>{s[parseInt(_)]&&n.push(s[parseInt(_)].dept_name)}),n},l=[];return o.forEach(a=>{const n=s[a.parent_id];a.breadcrumb=t(a.ancestors||"").join(" / "),n?(n.children==null&&(n.children=[]),n.children.push(a)):l.push(a)}),l}const I=o=>{z(o.user_id)},H=({option:o})=>({onClick(){y.value=o.breadcrumb||"全部成员",p.value=o.dept_id}});function M(){ee().then(o=>{const s=o.data.items||[];s.unshift({dept_id:-1,dept_name:"全部成员",parent_id:0,ancestors:"0"});for(const t of s)t.suffix=0,t.dept_id>0&&(t.ancestors=`${t.ancestors},${t.dept_id}`);b.value=T(s)})}async function $(){const o=await te();if(!o||o.code!=200)return;let s=o.data.items||[];s.map(t=>{t.online=!1,t.sort=1e6,t.position_items.sort((a,n)=>a.sort-n.sort);let l=[];for(const a of t.position_items)l.push(a.name),a.sort<t.sort&&(t.sort=a.sort);return t.position=l.join("、"),t}),C.value=s.sort((t,l)=>t.sort-l.sort)}return $(),M(),(o,s)=>{const t=v("n-icon"),l=v("n-input"),a=v("n-space");return c(),u("section",ne,[d("header",se,[d("div",ae,w(y.value)+" ("+w(k.value.length)+")",1),d("div",null,[r(a,{style:{display:"flex","align-items":"center"}},{default:g(()=>[r(l,{value:h.value,"onUpdate:value":s[0]||(s[0]=n=>h.value=n),valueModifiers:{trim:!0},placeholder:"搜索",clearable:"",style:{width:"200px"},round:""},{prefix:g(()=>[r(t,{component:f(X)},null,8,["component"])]),_:1},8,["value"]),r(t,{class:"pointer",style:{"margin-top":"5px"},component:f(Y),size:18,onClick:s[1]||(s[1]=n=>m.value=!m.value)},null,8,["component"])]),_:1})])]),d("section",re,[k.value.length?(c(),u("main",le,[d("div",ie,[(c(!0),u(P,null,U(k.value,n=>(c(),K(Q,{key:n.id,username:n.nickname,gender:n.gender,motto:n.position,flag:"查看",onClick:_=>I(n),onToTalk:_=>L(n)},null,8,["username","gender","motto","onClick","onToTalk"]))),128))])])):(c(),u("main",ce,[r(f(O),{size:"200",description:"暂无相关数据"},{icon:g(()=>[de]),_:1})])),m.value?(c(),u("aside",ue,[r(f(R),{"key-field":"dept_id","label-field":"dept_name",data:b.value,"default-expand-all":!0,cancelable:!0,"default-selected-keys":[-1],"node-props":H},null,8,["data"])])):q("",!0)])])}}},ke=E(_e,[["__scopeId","data-v-4e2ff6f8"]]);export{ke as default};
