import{a2 as S,bx as k,q as C,ae as K,a4 as N,a5 as $,a6 as I,a7 as c,a1 as o,aA as r,a8 as a,aC as f,bo as g,al as u,ab as F,ac as V,aa as q,at as E,au as R}from"./index-364c5099.js";import{b as T}from"./auth-25dc869f.js";import{i as h,a as B}from"./common-7041e017.js";import{u as D}from"./useSmsLock-dfb3e979.js";import{a as _,N as U}from"./FormItem-0aeeb3fa.js";const z=l=>(E("data-v-507fec7f"),l=l(),R(),l),M={class:"el-container is-vertical login-box forget"},P=z(()=>c("header",{class:"el-header box-header"},"找回密码",-1)),A={class:"el-main",style:{padding:"3px"}},G={class:"helper"},L={__name:"forget",setup(l){const{lockTime:m,start:v}=D("FORGET_PSW_SMS",120),p=k(),w=C(),b={sms_code:{required:!0,trigger:["blur","input"],message:"验证码不能为空！"},username:{required:!0,trigger:["blur","input"],validator(t,e){if(e){if(!h(e))return new Error("请正确填写手机号！")}else return new Error("手机号不能为空！");return!0}},password:{required:!0,trigger:["blur","input"],message:"密码不能为空！"}},s=K({username:"",password:"",sms_code:"",loading:!1}),y=()=>{s.loading=!0;const t=T({mobile:s.username,password:s.password,sms_code:s.sms_code});t.then(e=>{e.code==200?(window.$message.success("密码修改成功"),setTimeout(()=>{p.push("/auth/login")},500)):window.$message.warning(e.message)}),t.finally(()=>{s.loading=!1})},d=t=>{t.preventDefault(),w.value.validate(e=>{!e&&y()})},x=()=>{if(!h(s.username)){window.$message.warning("请正确填写手机号");return}const t=B({mobile:s.username,channel:"forget_account"});t.then(e=>{e.code==200?(v(),window.$message.success("短信发送成功")):window.$message.warning(e.message)}),t.finally(()=>{s.loading=!1})};return(t,e)=>{const i=N("n-button");return $(),I("section",M,[P,c("main",A,[o(a(U),{ref_key:"formRef",ref:w,size:"large",model:s,rules:b},{default:r(()=>[o(a(_),{path:"username","show-label":!1},{default:r(()=>[o(a(f),{placeholder:"登录账号/手机号",value:s.username,"onUpdate:value":e[0]||(e[0]=n=>s.username=n),maxlength:11,onKeydown:g(d,["enter"])},null,8,["value","onKeydown"])]),_:1}),o(a(_),{path:"sms_code","show-label":!1},{default:r(()=>[o(a(f),{placeholder:"验证码",maxlength:6,value:s.sms_code,"onUpdate:value":e[1]||(e[1]=n=>s.sms_code=n),onKeydown:g(d,["enter"])},null,8,["value","onKeydown"]),o(i,{tertiary:"",class:"mt-l5",onClick:x,disabled:a(m)>0},{default:r(()=>[u(" 获取验证码 "),F(c("span",null,"("+q(a(m))+"s)",513),[[V,a(m)>0]])]),_:1},8,["disabled"])]),_:1}),o(a(_),{path:"password","show-label":!1},{default:r(()=>[o(a(f),{placeholder:"设置密码",type:"password","show-password-on":"click",value:s.password,"onUpdate:value":e[2]||(e[2]=n=>s.password=n),onKeydown:g(d,["enter"])},null,8,["value","onKeydown"])]),_:1}),o(i,{type:"primary",size:"large",block:"",class:"mt-t20",onClick:d,loading:s.loading},{default:r(()=>[u(" 立即找回 ")]),_:1},8,["loading"])]),_:1},8,["model"]),c("div",G,[o(i,{text:"",color:"#409eff",onClick:e[3]||(e[3]=n=>a(p).push("/auth/register"))},{default:r(()=>[u(" 注册账号 ")]),_:1}),o(i,{text:"",color:"#409eff",onClick:e[4]||(e[4]=n=>a(p).push("/auth/login"))},{default:r(()=>[u(" 已有账号，立即登录? ")]),_:1})])])])}}},Q=S(L,[["__scopeId","data-v-507fec7f"]]);export{Q as default};
