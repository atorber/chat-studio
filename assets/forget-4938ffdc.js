import{_ as x,b6 as k,r as K,m as C,b as $,c as I,i as N,f as c,g as a,w as r,a as o,X as f,a0 as g,aX as _,A as u,k as F,v as V,t as E,W as R,K as T,L as q}from"./index-cfea8079.js";import{b as B}from"./auth-f4edc498.js";import{i as v,a as D}from"./common-37e99d2d.js";import{u as U}from"./useSmsLock-85bc634a.js";const z=l=>(T("data-v-507fec7f"),l=l(),q(),l),L={class:"el-container is-vertical login-box forget"},M=z(()=>c("header",{class:"el-header box-header"},"找回密码",-1)),P={class:"el-main",style:{padding:"3px"}},W={class:"helper"},X={__name:"forget",setup(l){const{lockTime:m,start:h}=U("FORGET_PSW_SMS",120),p=k(),w=K(),b={sms_code:{required:!0,trigger:["blur","input"],message:"验证码不能为空！"},username:{required:!0,trigger:["blur","input"],validator(t,e){if(e){if(!v(e))return new Error("请正确填写手机号！")}else return new Error("手机号不能为空！");return!0}},password:{required:!0,trigger:["blur","input"],message:"密码不能为空！"}},s=C({username:"",password:"",sms_code:"",loading:!1}),y=()=>{s.loading=!0;const t=B({mobile:s.username,password:s.password,sms_code:s.sms_code});t.then(e=>{e.code==200?(window.$message.success("密码修改成功"),setTimeout(()=>{p.push("/auth/login")},500)):window.$message.warning(e.message)}),t.finally(()=>{s.loading=!1})},d=t=>{t.preventDefault(),w.value.validate(e=>{!e&&y()})},S=()=>{if(!v(s.username)){window.$message.warning("请正确填写手机号");return}const t=D({mobile:s.username,channel:"forget_account"});t.then(e=>{e.code==200?(h(),window.$message.success("短信发送成功")):window.$message.warning(e.message)}),t.finally(()=>{s.loading=!1})};return(t,e)=>{const i=$("n-button");return I(),N("section",L,[M,c("main",P,[a(o(R),{ref_key:"formRef",ref:w,size:"large",model:s,rules:b},{default:r(()=>[a(o(f),{path:"username","show-label":!1},{default:r(()=>[a(o(g),{placeholder:"登录账号/手机号",value:s.username,"onUpdate:value":e[0]||(e[0]=n=>s.username=n),maxlength:11,onKeydown:_(d,["enter"])},null,8,["value","onKeydown"])]),_:1}),a(o(f),{path:"sms_code","show-label":!1},{default:r(()=>[a(o(g),{placeholder:"验证码",maxlength:6,value:s.sms_code,"onUpdate:value":e[1]||(e[1]=n=>s.sms_code=n),onKeydown:_(d,["enter"])},null,8,["value","onKeydown"]),a(i,{tertiary:"",class:"mt-l5",onClick:S,disabled:o(m)>0},{default:r(()=>[u(" 获取验证码 "),F(c("span",null,"("+E(o(m))+"s)",513),[[V,o(m)>0]])]),_:1},8,["disabled"])]),_:1}),a(o(f),{path:"password","show-label":!1},{default:r(()=>[a(o(g),{placeholder:"设置密码",type:"password","show-password-on":"click",value:s.password,"onUpdate:value":e[2]||(e[2]=n=>s.password=n),onKeydown:_(d,["enter"])},null,8,["value","onKeydown"])]),_:1}),a(i,{type:"primary",size:"large",block:"",class:"mt-t20",onClick:d,loading:s.loading},{default:r(()=>[u(" 立即找回 ")]),_:1},8,["loading"])]),_:1},8,["model"]),c("div",W,[a(i,{text:"",color:"#409eff",onClick:e[3]||(e[3]=n=>o(p).push("/auth/register"))},{default:r(()=>[u(" 注册账号 ")]),_:1}),a(i,{text:"",color:"#409eff",onClick:e[4]||(e[4]=n=>o(p).push("/auth/login"))},{default:r(()=>[u(" 已有账号，立即登录? ")]),_:1})])])])}}},H=x(X,[["__scopeId","data-v-507fec7f"]]);export{H as default};
