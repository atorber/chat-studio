import{r as f,d as P,f as k,h as x,w as l,i as d,c as e,C as _,j as t,aj as M,aZ as y,aF as S,b2 as E,s as U,b4 as R,e as q,q as N,v as I,t as $,b5 as D,b6 as F,b as A,aW as L,k as T,F as j,a_ as G,x as H,y as O}from"./index-29374566.js";import{S as B,i as W,a as Z,b as z}from"./common-0a5b7cf8.js";const J={style:{width:"100%","text-align":"right"}},K={__name:"EditorPassword",props:["modelValue"],emits:["update:modelValue","close"],setup(g,{emit:h}){const b=h,c=f(),s=P({oldPassword:"",newPassword:"",newPassword2:""}),V={oldPassword:{required:!0,trigger:["blur","input"],message:"登录密码不能为空！"},newPassword:{required:!0,trigger:["blur","input"],message:"新密码不能为空！"},newPassword2:{required:!0,trigger:["blur","change"],validator(m,o){return o?s.newPassword!==s.newPassword2?new Error("两次密码填写不一致！"):!0:new Error("确认密码不能为空！")}}},r=f(!1),w=()=>{r.value=!0;const m=R({old_password:s.oldPassword,new_password:s.newPassword});m.then(o=>{o.code===200?(window.$message.success("密码修改成功"),b("update:modelValue",!1)):window.$message.warning(o.message)}),m.finally(()=>{r.value=!1})},i=m=>{m.preventDefault(),c.value.validate(o=>{!o&&w()})};return(m,o)=>(k(),x(t(U),{show:g.modelValue,preset:"card",title:"修改密码？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":v=>{m.$emit("update:modelValue",v)}},{footer:l(()=>[d("div",J,[e(t(M),{type:"tertiary",onClick:o[3]||(o[3]=v=>m.$emit("update:modelValue",!1))},{default:l(()=>[_(" 取消 ")]),_:1}),e(t(M),{type:"primary",class:"mt-l15",loading:r.value,onClick:i},{default:l(()=>[_(" 保存修改 ")]),_:1},8,["loading"])])]),default:l(()=>[e(t(E),{ref_key:"formRef",ref:c,model:s,rules:V},{default:l(()=>[e(t(y),{label:"登录密码",path:"oldPassword"},{default:l(()=>[e(t(S),{placeholder:"请填写登录密码",type:"password",value:s.oldPassword,"onUpdate:value":o[0]||(o[0]=v=>s.oldPassword=v)},null,8,["value"])]),_:1}),e(t(y),{label:"设置新密码",path:"newPassword"},{default:l(()=>[e(t(S),{placeholder:"请填写新密码",type:"password",value:s.newPassword,"onUpdate:value":o[1]||(o[1]=v=>s.newPassword=v)},null,8,["value"])]),_:1}),e(t(y),{label:"确认新密码",path:"newPassword2"},{default:l(()=>[e(t(S),{placeholder:"请再次填写新密码",type:"password",value:s.newPassword2,"onUpdate:value":o[2]||(o[2]=v=>s.newPassword2=v)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"]))}},Q={style:{width:"100%","text-align":"right"}},X={__name:"EditorMobile",props:["modelValue"],emits:["update:modelValue","success"],setup(g,{emit:h}){const b=h,c=f(),s=P({password:"",mobile:"",sms_code:""}),V={password:{required:!0,trigger:["input"],message:"账号密码不能为空！"},mobile:{required:!0,trigger:["input"],message:"手机号不能为空！"},sms_code:{required:!0,trigger:["change"],message:"验证码不能为空！"}},r=f(!1),w=f(0),i=new B("CHANGE_MOBILE_SMS",120,n=>w.value=n),m=()=>{if(!W(s.mobile)){window.$message.warning("请正确填写手机号");return}Z({mobile:s.mobile,channel:"change_account"}).then(({code:a,data:p,message:u})=>{a===200?(i.start(),p.is_debug?(s.sms_code=p.sms_code,window.$message.success("已开启验证码自动填充")):window.$message.success("短信发送成功")):window.$message.warning(u)})},o=()=>{r.value=!0;const n=D(s);n.then(({code:a,message:p})=>{a===200?(window.$message.success("手机号修改成功..."),b("success",s.mobile)):window.$message.warning(p)}),n.finally(()=>{r.value=!1})},v=n=>{n.preventDefault(),c.value.validate(a=>{!a&&o()})};return(n,a)=>{const p=q("n-button");return k(),x(t(U),{show:g.modelValue,preset:"card",title:"换绑手机？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":u=>{n.$emit("update:modelValue",u)}},{footer:l(()=>[d("div",Q,[e(p,{type:"tertiary",onClick:a[3]||(a[3]=u=>n.$emit("update:modelValue",!1))},{default:l(()=>[_(" 取消 ")]),_:1}),e(p,{type:"primary",class:"mt-l15",loading:r.value,onClick:v},{default:l(()=>[_(" 保存修改 ")]),_:1},8,["loading"])])]),default:l(()=>[e(t(E),{ref_key:"formRef",ref:c,model:s,rules:V},{default:l(()=>[e(t(y),{label:"登录密码",path:"password"},{default:l(()=>[e(t(S),{placeholder:"请填写登录密码",type:"password",value:s.password,"onUpdate:value":a[0]||(a[0]=u=>s.password=u)},null,8,["value"])]),_:1}),e(t(y),{label:"新手机号码",path:"mobile"},{default:l(()=>[e(t(S),{placeholder:"请填写新手机号码",type:"text",value:s.mobile,"onUpdate:value":a[1]||(a[1]=u=>s.mobile=u)},null,8,["value"])]),_:1}),e(t(y),{label:"短信验证码",path:"sms_code"},{default:l(()=>[e(t(S),{placeholder:"请填写验证码",type:"text",value:s.sms_code,"onUpdate:value":a[2]||(a[2]=u=>s.sms_code=u)},null,8,["value"]),e(p,{tertiary:"",class:"mt-l5",onClick:m,disabled:w.value>0},{default:l(()=>[_(" 获取验证码 "),N(d("span",null,"("+$(w.value)+"s)",513),[[I,w.value>0]])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"])}}},Y={style:{width:"100%","text-align":"right"}},ee={__name:"EditorEmail",props:["modelValue"],emits:["update:modelValue","success"],setup(g,{emit:h}){const b=h,c=f(0),s=new B("CHANGE_EMAIL_SMS",120,n=>c.value=n),V=f(),r=P({password:"",email:"",code:""}),w={password:{required:!0,trigger:["input"],message:"账号密码不能为空！"},email:{required:!0,trigger:["input"],message:"邮箱不能为空！"},code:{required:!0,trigger:["change"],message:"验证码不能为空！"}},i=f(!1),m=()=>{z({email:r.email}).then(({code:a,message:p})=>{a===200?(s.start(),window.$message.success("邮件发送成功")):window.$message.warning(p)})},o=()=>{i.value=!0;const n=F(r);n.then(({code:a,message:p})=>{a===200?(window.$message.success("密码修改成功..."),b("success",r.email)):window.$message.warning(p)}),n.finally(()=>{i.value=!1})},v=n=>{n.preventDefault(),V.value.validate(a=>{!a&&o()})};return(n,a)=>{const p=q("n-button");return k(),x(t(U),{show:g.modelValue,preset:"card",title:"修改邮箱？",class:"modal-radius",style:{"max-width":"400px"},"on-update:show":u=>{n.$emit("update:modelValue",u)}},{footer:l(()=>[d("div",Y,[e(p,{type:"tertiary",onClick:a[3]||(a[3]=u=>n.$emit("update:modelValue",!1))},{default:l(()=>[_(" 取消 ")]),_:1}),e(p,{type:"primary",class:"mt-l15",loading:i.value,onClick:v},{default:l(()=>[_(" 保存修改 ")]),_:1},8,["loading"])])]),default:l(()=>[e(t(E),{ref_key:"formRef",ref:V,model:r,rules:w},{default:l(()=>[e(t(y),{label:"登录密码",path:"password"},{default:l(()=>[e(t(S),{placeholder:"请填写登录密码",type:"password",value:r.password,"onUpdate:value":a[0]||(a[0]=u=>r.password=u)},null,8,["value"])]),_:1}),e(t(y),{label:"新邮箱",path:"email"},{default:l(()=>[e(t(S),{placeholder:"请填写新邮箱",type:"text",value:r.email,"onUpdate:value":a[1]||(a[1]=u=>r.email=u)},null,8,["value"])]),_:1}),e(t(y),{label:"邮箱验证码",path:"code"},{default:l(()=>[e(t(S),{placeholder:"请填写验证码",type:"text",value:r.code,"onUpdate:value":a[2]||(a[2]=u=>r.code=u)},null,8,["value"]),e(p,{tertiary:"",class:"mt-l5",onClick:m,disabled:c.value>0},{default:l(()=>[_(" 获取验证码 "),N(d("span",null,"("+$(c.value)+"s)",513),[[I,c.value>0]])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","on-update:show"])}}};const C=g=>(H("data-v-dd143c8e"),g=g(),O(),g),se=C(()=>d("h3",{class:"title"},"安全设置",-1)),ae={class:"view-box"},te={class:"view-list"},le=C(()=>d("div",{class:"content"},[d("div",{class:"name"},"账户密码"),d("div",{class:"desc"},"当前密码强度 ：中")],-1)),oe={class:"tools"},de={class:"view-list"},ne={class:"content"},re=C(()=>d("div",{class:"name"},"绑定手机",-1)),ie={class:"desc"},ue={class:"tools"},me={class:"view-list"},pe={class:"content"},ce=C(()=>d("div",{class:"name"},"绑定邮箱",-1)),we={class:"desc"},ve={class:"tools"},fe={__name:"security",setup(g){const h=L(),b=f(!1),c=f(!1),s=f(!1),V=w=>{c.value=!1,h.mobile=w},r=w=>{s.value=!1,h.email=w};return(w,i)=>{const m=q("n-button");return k(),T(j,null,[d("section",null,[se,d("div",ae,[d("div",te,[le,d("div",oe,[e(m,{type:"primary",text:"",onClick:i[0]||(i[0]=o=>b.value=!0)},{default:l(()=>[_(" 修改 ")]),_:1})])]),d("div",de,[d("div",ne,[re,d("div",ie,"已绑定手机 ："+$(t(G)(t(h).mobile)),1)]),d("div",ue,[e(m,{type:"primary",text:"",onClick:i[1]||(i[1]=o=>c.value=!0)},{default:l(()=>[_(" 修改 ")]),_:1})])]),d("div",me,[d("div",pe,[ce,d("div",we,"已绑定邮箱 ："+$(t(h).email||"未设置"),1)]),d("div",ve,[e(m,{type:"primary",text:"",onClick:i[2]||(i[2]=o=>s.value=!0)},{default:l(()=>[_(" 修改 ")]),_:1})])])])]),e(K,{modelValue:b.value,"onUpdate:modelValue":i[3]||(i[3]=o=>b.value=o)},null,8,["modelValue"]),e(X,{modelValue:c.value,"onUpdate:modelValue":i[4]||(i[4]=o=>c.value=o),onSuccess:V},null,8,["modelValue"]),e(ee,{modelValue:s.value,"onUpdate:modelValue":i[5]||(i[5]=o=>s.value=o),onSuccess:r},null,8,["modelValue"])],64)}}},he=A(fe,[["__scopeId","data-v-dd143c8e"]]);export{he as default};
