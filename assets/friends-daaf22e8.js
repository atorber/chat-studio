import{I as re,g as t,_ as F,s as V,r as w,p as K,b as x,c as v,e as $,w as a,f as u,A as I,a as n,W as q,X,a0 as j,aX as ie,k as Z,v as B,a1 as W,bo as de,d as A,m as H,l as E,bp as Y,bq as ce,K as J,L as Q,b6 as ue,aq as pe,o as me,br as _e,i as U,F as G,y as O,ad as ve,t as P,ac as fe,E as R,Z as he,C as we,af as Ce,aL as ge}from"./index-cfea8079.js";import{_ as ee}from"./no-data-bde0995b.js";import{M as ye}from"./MemberCard-9baa8629.js";import{D as ke}from"./vuedraggable.umd-89087a53.js";import{I as xe}from"./Delete-45955bb9.js";import{u as be}from"./useEventBus-4be26073.js";import{P as Se}from"./Plus-ac52bf6f.js";import{S as Me}from"./Search-f8233675.js";const $e=re("drag",!1,function(o){return t("svg",{width:o.size,height:o.size,viewBox:"0 0 48 48",fill:"none"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19 10C19 12.2091 17.2091 14 15 14C12.7909 14 11 12.2091 11 10C11 7.79086 12.7909 6 15 6C17.2091 6 19 7.79086 19 10ZM15 28C17.2091 28 19 26.2091 19 24C19 21.7909 17.2091 20 15 20C12.7909 20 11 21.7909 11 24C11 26.2091 12.7909 28 15 28ZM15 42C17.2091 42 19 40.2091 19 38C19 35.7909 17.2091 34 15 34C12.7909 34 11 35.7909 11 38C11 40.2091 12.7909 42 15 42Z",fill:o.colors[0]},null),t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M37 10C37 12.2091 35.2091 14 33 14C30.7909 14 29 12.2091 29 10C29 7.79086 30.7909 6 33 6C35.2091 6 37 7.79086 37 10ZM33 28C35.2091 28 37 26.2091 37 24C37 21.7909 35.2091 20 33 20C30.7909 20 29 21.7909 29 24C29 26.2091 30.7909 28 33 28ZM33 42C35.2091 42 37 40.2091 37 38C37 35.7909 35.2091 34 33 34C30.7909 34 29 35.7909 29 38C29 40.2091 30.7909 42 33 42Z",fill:o.colors[0]},null)])});const De={style:{color:"red"}},Ie={style:{width:"100%","text-align":"right"}},Te={__name:"UserSearchModal",emits:["update:show"],setup(o,{emit:D}){const g=V("$user"),c=D,f=w(!0),s=w(""),b=w(!1),S=p=>{b.value=p,p&&setTimeout(()=>{b.value=!1},2e3)},y=()=>{s.value.length&&de({mobile:s.value}).then(p=>{S(p.code!=200),p.code==200&&g(p.data.id)})},M=K(()=>s.value.trim().length==0),h=()=>{c("update:show",!1)};return(p,r)=>{const d=x("n-button");return v(),$(n(W),{show:f.value,"onUpdate:show":r[1]||(r[1]=m=>f.value=m),preset:"card",title:"好友搜索",size:"huge",bordered:!1,class:"modal-radius",style:{"max-width":"450px"},"mask-closable":!1,"on-after-leave":h,"on-update:show":h,"transform-origin":"center"},{footer:a(()=>[u("div",Ie,[t(d,{type:"tertiary",onClick:h},{default:a(()=>[I(" 取消 ")]),_:1}),t(d,{type:"primary",onClick:y,class:"mt-l15",disabled:M.value},{default:a(()=>[I(" 查询 ")]),_:1},8,["disabled"])])]),default:a(()=>[t(n(q),null,{default:a(()=>[t(n(X),{label:"请输入手机号",required:!0},{default:a(()=>[t(n(j),{placeholder:"必填",maxlength:30,value:s.value,"onUpdate:value":r[0]||(r[0]=m=>s.value=m),onKeydown:ie(y,["enter"])},null,8,["value","onKeydown"])]),_:1}),Z(u("p",De,"无法找到该用户，请检查搜索内容并重试!",512),[[B,b.value]])]),_:1})]),_:1},8,["show"])}}},Ue=F(Te,[["__scopeId","data-v-ddcc8605"]]),Ne=o=>(J("data-v-78a20716"),o=o(),Q(),o),Le=Ne(()=>u("img",{src:ee,alt:""},null,-1)),ze={class:"options"},Ge={class:"option"},Ze={class:"footer",style:{}},Be=A({__name:"GroupManage",emits:["close","relaod"],setup(o,{emit:D}){const g=D;let c=1;const f=w(!0),s=H([]),b=()=>{g("close")},S=async()=>{let{code:r,data:d}=await Y();if(r!=200)return;let m=d.items||[];for(const _ of m)_.id&&s.push({id:_.id,name:_.name,index:c++,count:_.count});s.length||s.push({id:0,name:"",index:c++,count:0})},y=()=>{ce({items:s}).then(({code:r,message:d})=>{r==200?(window.$message.success("保存成功"),g("relaod"),g("close")):window.$message.error(d)})},M=()=>{s.push({name:"",id:0,index:c++,count:0})},h=r=>{let d=()=>{let m=s.findIndex(_=>_.index==r.index);m>=0&&s.length>0&&s.splice(m,1)};r.count>0?window.$dialog.create({title:"温馨提示",content:`【${r.name}】分组下有${r.count}个好友，确定要删除吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:d}):d()},p=K(()=>s.some(r=>r.name.trim().length===0));return S(),(r,d)=>{const m=x("n-empty"),_=x("n-icon"),T=x("n-button");return v(),$(n(W),{show:f.value,"onUpdate:show":d[1]||(d[1]=k=>f.value=k),preset:"card",title:"联系人分组",size:"huge",bordered:!1,class:"modal-radius",style:{"max-width":"450px"},"on-after-leave":b},{footer:a(()=>[u("div",Ze,[u("div",null,[s.length<6?(v(),$(T,{key:0,text:"",type:"primary",onClick:M},{default:a(()=>[I(" 添加分组 ")]),_:1})):E("",!0)]),u("div",null,[t(T,{type:"tertiary",onClick:d[0]||(d[0]=k=>f.value=!1)},{default:a(()=>[I(" 取消 ")]),_:1}),t(T,{type:"primary",onClick:y,class:"mt-l15",disabled:p.value},{default:a(()=>[I(" 保存 ")]),_:1},8,["disabled"])])])]),default:a(()=>[Z(t(m,{size:"50",description:"暂未设置分组"},{icon:a(()=>[Le]),_:1},512),[[B,s.length==0]]),Z(t(n(q),null,{default:a(()=>[t(n(X),{label:"分组列表"},{default:a(()=>[u("div",ze,[t(n(ke),{class:"draggable-ul",animation:"300",list:s,itemKey:"index",handle:".handle"},{item:a(({element:k})=>[u("div",Ge,[t(_,{size:"20",class:"handle",component:n($e)},null,8,["component"]),t(n(j),{placeholder:"必填",value:k.name,"onUpdate:value":N=>k.name=N,maxlength:20,style:{margin:"0 10px"}},null,8,["value","onUpdate:value"]),t(_,{size:"16",class:"pointer",component:n(xe),color:"red",onClick:N=>h(k)},null,8,["component","onClick"])])]),_:1},8,["list"])])]),_:1})]),_:1},512),[[B,s.length>0]])]),_:1},8,["show"])}}});const Ee=F(Be,[["__scopeId","data-v-78a20716"]]);function Fe(){const o=H({options:[],show:!1,x:0,y:0,item:{}});return{dropdown:o,showDropdownMenu:(c,f)=>{o.item=Object.assign({},f),o.options=[],o.options.push({label:"删除好友",key:"delete"}),o.x=c.clientX,o.y=c.clientY,o.show=!0},closeDropdownMenu:()=>{o.show=!1,o.item={}}}}const Ke=o=>(J("data-v-575b387f"),o=o(),Q(),o),Oe={class:"el-container is-vertical height100"},Pe={class:"el-header me-view-header bdr-b"},Re={class:"groups"},Ve={class:"tools"},qe={key:0,id:"drawer-target",class:"el-main pd-10 me-scrollbar me-scrollbar-thumb"},Xe={class:"cards"},je={key:1,class:"el-main flex-center"},We=Ke(()=>u("img",{src:ee,alt:""},null,-1)),Ae=A({__name:"friends",setup(o){const D=ue(),g=pe(),{dropdown:c,showDropdownMenu:f,closeDropdownMenu:s}=Fe(),b=V("$user"),S=w(!1),y=w(!1),M=w(""),h=w(0),p=w([]),r=w([]),d=K(()=>p.value.filter(e=>{let C=(e.remark||e.nickname).toLowerCase().indexOf(M.value.toLowerCase());return h.value==0?C!=-1:C!=-1&&h.value==e.group_id})),m=()=>{Ce().then(e=>{e.code==200&&(p.value=e.data.items||[])})},_=()=>{Y().then(e=>{e.code==200&&(r.value=e.data.items||[])})},T=e=>{g.toTalk(1,e.id,D)},k=e=>{b(e.id)},N=e=>{let i=e.remark||e.nickname;window.$dialog.create({showIcon:!1,title:`删除 [${i}] 联系人？`,content:"删除后不再接收对方任何消息。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{ge({friend_id:e.id}).then(({code:C,message:L})=>{C==200?(window.$message.success("删除联系人成功"),m()):window.$message.error(L)})}})},te=(e,i)=>{f(e,i),e.preventDefault()},oe=(e="")=>{const i={delete:N};i[e]&&i[e](c.item),s()},ne=e=>{switch(e){case"add":S.value=!0;break;case"group":y.value=!0;break}},se=e=>{let i=p.value.find(C=>C.id==e.user_id);i&&(i.remark=e.remark)};return me(()=>{m(),_()}),be([{name:_e.UpdateRemark,event:se}]),(e,i)=>{const C=x("n-icon"),L=x("n-input"),ae=x("n-button"),le=x("n-empty");return v(),U(G,null,[u("section",Oe,[u("header",Pe,[u("div",Re,[r.value.length?(v(),$(n(fe),{key:0,value:h.value,"onUpdate:value":i[0]||(i[0]=l=>h.value=l)},{default:a(()=>[(v(!0),U(G,null,O(r.value,l=>(v(),$(n(ve),{key:l.id,name:l.id},{default:a(()=>[I(P(l.name)+"("+P(l.count)+") ",1)]),_:2},1032,["name"]))),128))]),_:1},8,["value"])):E("",!0)]),u("div",Ve,[t(n(he),null,{default:a(()=>[t(L,{value:M.value,"onUpdate:value":i[1]||(i[1]=l=>M.value=l),valueModifiers:{trim:!0},placeholder:"搜索",clearable:"",style:{"max-width":"200px"},round:""},{prefix:a(()=>[t(C,{component:n(Me)},null,8,["component"])]),_:1},8,["value"]),t(n(R),{animated:!0,trigger:"hover","show-arrow":!1,onSelect:ne,options:[{label:"添加好友",key:"add"},{label:"分组管理",key:"group"}]},{default:a(()=>[t(ae,{circle:""},{icon:a(()=>[t(C,{component:n(Se)},null,8,["component"])]),_:1})]),_:1})]),_:1})])]),d.value.length?(v(),U("main",qe,[u("div",Xe,[(v(!0),U(G,null,O(d.value,l=>(v(),$(ye,{key:l.id,avatar:l.avatar,username:l.remark||l.nickname,gender:l.gender,motto:l.motto,flag:"查看",onClick:z=>k(l),onToTalk:z=>T(l),onContextmenu:we(z=>te(z,l),["prevent"])},null,8,["avatar","username","gender","motto","onClick","onToTalk","onContextmenu"]))),128))])])):(v(),U("main",je,[t(le,{size:"200",description:"暂无相关数据"},{icon:a(()=>[We]),_:1})]))]),t(Ue,{show:S.value,"onUpdate:show":i[2]||(i[2]=l=>S.value=l)},null,8,["show"]),y.value?(v(),$(Ee,{key:0,onClose:i[3]||(i[3]=l=>y.value=!1),onRelaod:_})):E("",!0),t(n(R),{show:n(c).show,x:n(c).x,y:n(c).y,options:n(c).options,onSelect:oe,onClickoutside:n(s)},null,8,["show","x","y","options","onClickoutside"])],64)}}});const st=F(Ae,[["__scopeId","data-v-575b387f"]]);export{st as default};
