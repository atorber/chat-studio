import{_ as S,r as N,aA as j,m as E,p as g,o as M,b as B,c as r,i as l,f as t,t as a,a as d,F as u,y as b,g as h,az as O,j as U,N as z,w as A,A as F,cY as I}from"./index-0666afcb.js";const $={class:"im-message-vote"},D={class:"vote-from"},H={class:"vheader"},L={style:{"font-weight":"bold"}},P={class:"vbody"},T={class:"vote-option"},Y={class:"vote-census"},q={class:"vote-progress"},G={class:"vfooter vote-view"},J={class:"vbody"},K={class:"checkbox"},Q=["onClick"],R={class:"vfooter"},W={__name:"VoteMessage",props:{extra:Object,data:Object},setup(x){const p=x,c=N(p.extra),k=j(),_=c.value.detail.answer_mode,i=E({options:[]}),f=g(()=>i.options.some(s=>s.is_checked)),w=g(()=>c.value.vote_users.some(s=>s==k.uid));function C(s){for(const o of s)i.options.push({key:o.key,value:o.value,is_checked:!1,num:0,progress:0})}function m(s){let o=s.count;i.options.forEach(n=>{n.num=s.options[n.key],o>0&&(n.progress=s.options[n.key]/o*100)})}function y(s,o){_==0&&i.options.forEach(n=>n.is_checked=!1),o.is_checked=s}const V=()=>{if(!f.value)return;let s=[];i.options.forEach(o=>{o.is_checked&&s.push(o.key)}),I({record_id:p.data.id,options:s.join(",")}).then(o=>{o.code==200&&(m(o.data),c.value.vote_users.push(k.uid),c.value.detail.answered_num++)})};return M(()=>{C(c.value.detail.answer_option),m(c.value.statistics)}),(s,o)=>{const n=B("n-button");return r(),l("section",$,[t("div",D,[t("div",H,[t("p",L,a(d(_)==1?"[多选投票]":"[单选投票]"),1),t("p",null,a(c.value.detail.title),1)]),w.value?(r(),l(u,{key:0},[t("div",P,[(r(!0),l(u,null,b(i.options,e=>(r(),l("div",{class:"vote-view",key:e.key},[t("p",T,a(e.key)+"、 "+a(e.value),1),t("p",Y,a(e.num)+" 票 "+a(e.progress)+"%",1),t("p",q,[h(d(O),{type:"line",height:5,"show-indicator":!1,percentage:parseInt(e.progress),color:"#1890ff"},null,8,["percentage"])])]))),128))]),t("div",G,[t("p",null,"应参与人数："+a(c.value.detail.answer_num)+" 人",1),t("p",null,"实际参与人数："+a(c.value.detail.answered_num)+" 人",1)])],64)):(r(),l(u,{key:1},[t("div",J,[(r(!0),l(u,null,b(i.options,e=>(r(),l("div",{class:U(["option",{radio:d(_)==0}]),key:e.key},[t("p",K,[h(d(z),{checked:e.is_checked,"onUpdate:checked":[v=>e.is_checked=v,v=>y(e.is_checked,e)]},null,8,["checked","onUpdate:checked"])]),t("p",{class:"text",onClick:v=>y(!e.is_checked,e)},a(e.key)+"、"+a(e.value),9,Q)],2))),128))]),t("div",R,[h(n,{plain:"",round:"",onClick:V},{default:A(()=>[F(a(f.value?"立即投票":"请选择进行投票"),1)]),_:1})])],64))])])}}},Z=S(W,[["__scopeId","data-v-5ab6360b"]]);export{Z as default};
